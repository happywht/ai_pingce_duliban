# 后端服务打包使用说明

## 📦 打包完成信息

✅ **打包成功完成！**

### 📁 生成的文件

| 文件名 | 位置 | 大小 | 描述 |
|--------|------|------|------|
| `backend_service.exe` | `dist/` | 36MB | 后端服务单文件可执行程序 |

### 🔧 打包配置详情

#### 主程序
- **主文件**: `backend_service1126.py`
- **依赖包含**: Flask, SQLAlchemy, requests, pyodbc, anthropic等
- **数据库支持**: SQL Server, MySQL, PostgreSQL, SQLite
- **AI功能**: 智谱AI集成

#### 打包选项
- **打包器**: PyInstaller 6.17.0
- **Python版本**: 3.13.6
- **目标平台**: Windows 64位
- **UPX压缩**: 已启用
- **控制台模式**: 已启用

#### 包含的文件
- ✅ `config.py` - 配置管理模块
- ✅ `advanced_document_parser.py` - 文档解析模块
- ✅ `.env` - 环境配置文件（你的实际配置）
- ✅ `.env.sqlserver.example` - 配置模板文件
- ✅ `sql/` - SQL脚本目录

#### 内置依赖
- **Web框架**: Flask, Flask-CORS, Flask-SQLAlchemy
- **数据库**: pyodbc, pymysql, psycopg2-binary
- **HTTP**: requests, urllib3
- **AI**: anthropic
- **文档处理**: pytesseract, pdf2image, pypdf, docx, pandas
- **其他**: Pillow, openpyxl, numpy等

## 🚀 使用方法

### 1. 基本运行

```bash
# 直接运行exe文件
dist/backend_service.exe
```

### 2. 配置文件

程序会在当前目录寻找以下配置文件：
- `.env` - 主要配置文件（优先）
- `.env.sqlserver.example` - 配置模板（参考）

#### 配置示例
```env
# 数据库配置
DB_TYPE=mssql
DB_HOST=10.1.24.73
DB_PORT=1433
DB_USER=sys_ai
DB_PASSWORD=Cjy@2025Ai
DB_NAME=ai_doc_review

# 智谱AI配置
ZHIPU_API_KEY=ccd69d4c776d4e2696a6ef026159fb9c.YUPVkBmrRXu1xoZG
ZHIPU_BASE_URL=https://open.bigmodel.cn/api/anthropic
ZHIPU_MODEL=glm-4.5

# Flask配置
FLASK_HOST=0.0.0.0
FLASK_PORT=5000
FLASK_DEBUG=false
```

### 3. 日志查看

程序运行时会生成日志文件：
- `logs/` - 日志目录
- `backend.log` - 主日志文件
- 使用RotatingFileHandler自动轮转

## 🌐 服务访问

运行成功后，可通过以下地址访问：

### API接口
- **基础地址**: `http://localhost:5000/api`
- **健康检查**: `http://localhost:5000/api/health`
- **项目列表**: `http://localhost:5000/api/projects`

### 主要API端点
| 方法 | 路径 | 功能 |
|------|------|------|
| GET | `/api/projects` | 获取项目列表 |
| GET | `/api/projects/{id}` | 获取项目详情 |
| POST | `/api/start_evaluation` | 启动评测任务 |
| GET | `/api/get_result` | 获取评测结果 |

## ⚠️ 注意事项

### 1. 依赖环境
- **Windows操作系统**: Windows 7/10/11 64位
- **数据库驱动**: SQL Server ODBC Driver（如使用mssql）
- **Python环境**: 无需安装，exe文件已包含所有依赖

### 2. 数据库要求
如使用SQL Server，需要安装：
- Microsoft ODBC Driver 17 for SQL Server
- 或更高版本的SQL Server ODBC驱动

### 3. 文件权限
确保exe文件有足够权限：
- 读取配置文件
- 写入日志文件
- 创建必要的目录

### 4. 端口占用
- 默认使用5000端口
- 可通过配置文件修改
- 确保端口未被其他程序占用

## 🔧 故障排除

### 常见问题

#### 1. 数据库连接失败
```
错误: 'IM002' [Microsoft][ODBC 驱动程序管理器] 未发现数据源名称
```
**解决方案**: 安装SQL Server ODBC Driver

#### 2. 端口占用
```
错误: [Errno 98] Address already in use
```
**解决方案**: 修改配置文件中的FLASK_PORT

#### 3. 权限问题
```
错误: Permission denied
```
**解决方案**: 以管理员身份运行或检查文件权限

#### 4. 配置文件未找到
```
警告: 配置文件未找到，使用默认值
```
**解决方案**: 确保.env文件在exe文件同级目录

### 日志查看
```bash
# 查看最新日志
type logs\backend.log

# 实时监控日志（Windows）
tail -f logs\backend.log
```

## 📊 性能说明

### 启动时间
- **冷启动**: 3-5秒
- **热启动**: 1-2秒

### 内存占用
- **运行内存**: 50-100MB
- **峰值内存**: 200-300MB（处理大文档时）

### 并发支持
- **最大并发**: 可配置（默认2个）
- **文件处理**: 支持多线程处理

## 🔄 更新和部署

### 更新步骤
1. 停止当前运行的服务
2. 替换exe文件
3. 更新配置文件（如需要）
4. 重新启动服务

### 部署到其他机器
1. 复制整个 `dist/` 目录
2. 确保目标机器满足运行环境要求
3. 根据需要修改 `.env` 配置文件
4. 运行 `backend_service.exe`

## 📞 技术支持

如遇到问题，请提供：
1. 错误信息截图或文本
2. 配置文件内容
3. 运行环境详情
4. 操作系统版本

---
**打包时间**: 2025-12-18
**版本**: v1.0
**打包工具**: PyInstaller
**支持**: Windows 64位