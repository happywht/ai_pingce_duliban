# é¡¹ç›®ä¿¡æ¯æ¥å£æ›´æ–°è¯´æ˜

## ğŸ“‹ å˜æ›´æ¦‚è¿°

æ ¹æ®æ–°çš„é¡¹ç›®ä¿¡æ¯æ¥å£å“åº”æ ¼å¼ï¼Œç³»ç»Ÿå·²å®Œæˆé€‚é…ï¼Œæ–°å¢äº†ä¸¤ä¸ªé¡¹ç›®ç»ç†ç›¸å…³å­—æ®µçš„æ”¯æŒã€‚

## ğŸ”„ æ¥å£å˜æ›´è¯¦æƒ…

### åŸæœ‰å“åº”æ ¼å¼
```json
{
  "code": 0,
  "msg": "è¯·æ±‚æˆåŠŸ",
  "data": [
    {
      "project_id": "é¡¹ç›®ID",
      "project_code": "é¡¹ç›®ç¼–å·",
      "project_name": "é¡¹ç›®åç§°"
    }
  ]
}
```

### æ–°å¢å“åº”æ ¼å¼
```json
{
  "code": 0,
  "msg": "è¯·æ±‚æˆåŠŸ",
  "data": [
    {
      "project_id": "é¡¹ç›®ID",
      "project_code": "é¡¹ç›®ç¼–å·",
      "project_name": "é¡¹ç›®åç§°",
      "epc_manager": "é¡¹ç›®ç»ç†",
      "entrust_manager": "é¡¹ç›®æ‰§è¡Œç»ç†"
    }
  ]
}
```

### æ–°å¢å­—æ®µè¯´æ˜
- **epc_manager**: é¡¹ç›®ç»ç†ï¼Œè´Ÿè´£æ•´ä½“é¡¹ç›®ç®¡ç†å’Œåè°ƒ
- **entrust_manager**: é¡¹ç›®æ‰§è¡Œç»ç†ï¼Œè´Ÿè´£å…·ä½“æ‰§è¡Œå’Œå®æ–½

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„å˜æ›´

### Projectè¡¨æ–°å¢å­—æ®µ
| å­—æ®µå | æ•°æ®ç±»å‹ | é•¿åº¦ | æ˜¯å¦ä¸ºç©º | è¯´æ˜ |
|--------|----------|------|----------|------|
| epc_manager | VARCHAR/NVARCHAR | 100 | YES | é¡¹ç›®ç»ç† |
| entrust_manager | VARCHAR/NVARCHAR | 100 | YES | é¡¹ç›®æ‰§è¡Œç»ç† |

### æ•°æ®åº“é€‚é…æƒ…å†µ
- âœ… **SQL Server**: `sql/current_database_schema_sqlserver.sql` å·²æ›´æ–°
- âœ… **MySQL**: `create_database_v2.py` å·²æ›´æ–°
- âœ… **ç°æœ‰æ•°æ®åº“**: åˆ›å»ºäº† `migrate_database.py` è¿ç§»è„šæœ¬

## ğŸ”§ ä»£ç å˜æ›´è¯¦æƒ…

### 1. åç«¯æ¨¡å‹æ›´æ–°
**æ–‡ä»¶**: `backend_service1126.py` (ç¬¬368-377è¡Œ)
```python
class Project(db.Model):
    # ç°æœ‰å­—æ®µ...
    epc_manager = db.Column(get_string_field(100))  # é¡¹ç›®ç»ç†
    entrust_manager = db.Column(get_string_field(100))  # é¡¹ç›®æ‰§è¡Œç»ç†
    # ç°æœ‰å­—æ®µ...
```

### 2. æ•°æ®åŒæ­¥é€»è¾‘æ›´æ–°
**æ–‡ä»¶**: `backend_service1126.py` (ç¬¬2654-2671è¡Œ)
```python
# æ›´æ–°æ–°å¢å­—æ®µ
db_p.epc_manager = ext_p.get('epc_manager')
db_p.entrust_manager = ext_p.get('entrust_manager')
```

### 3. APIå“åº”æ›´æ–°
æ‰€æœ‰é¡¹ç›®ç›¸å…³çš„APIå“åº”å·²æ›´æ–°ï¼ŒåŒ…å«æ–°å¢å­—æ®µï¼š
- `GET /api/projects` (ç¬¬2689-2698è¡Œ)
- `GET /api/projects/{id}/result` (ç¬¬2855-2866è¡Œ)
- `GET /api/projects/{id}/tasks/{task_id}` (ç¬¬3085-3092è¡Œ)
- `GET /api/projects/{id}/statistics` (ç¬¬3195-3202è¡Œ)

## ğŸš€ éƒ¨ç½²å’Œè¿ç§»

### æ­¥éª¤1: æ•°æ®åº“å­—æ®µæ·»åŠ 
```bash
# æ·»åŠ æ–°çš„æ•°æ®åº“å­—æ®µ
python migrate_database.py
```

### æ­¥éª¤2: æœåŠ¡é‡å¯
```bash
# é‡å¯åç«¯æœåŠ¡
python start_service.py
```

### æ­¥éª¤3: æµ‹è¯•éªŒè¯
```bash
# æµ‹è¯•æ–°çš„APIå“åº”
python test_new_api_response.py
```

## ğŸ§ª æµ‹è¯•éªŒè¯

### APIæµ‹è¯•
```bash
curl -X POST "http://127.0.0.1:5000/api/projects/sync"
```

### å‰ç«¯æµ‹è¯•
- é¡¹ç›®åˆ—è¡¨é¡µé¢åº”æ˜¾ç¤ºé¡¹ç›®ç»ç†å’Œæ‰§è¡Œç»ç†ä¿¡æ¯
- é¡¹ç›®è¯¦æƒ…é¡µé¢åº”åŒ…å«å®Œæ•´çš„é¡¹ç›®äººå‘˜ä¿¡æ¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å‘åå…¼å®¹**: æ–°å­—æ®µä½¿ç”¨ `get()` æ–¹æ³•è·å–ï¼Œç¡®ä¿å‘åå…¼å®¹
2. **æ•°æ®åº“è¿ç§»**: ç°æœ‰æ•°æ®åº“éœ€è¦è¿è¡Œè¿ç§»è„šæœ¬
3. **APIæ ¼å¼**: å¤–éƒ¨APIå“åº”æ ¼å¼å¿…é¡»åŒ…å«æ–°å¢å­—æ®µ
4. **å‰ç«¯é€‚é…**: å‰ç«¯é¡µé¢å¯èƒ½éœ€è¦æ›´æ–°ä»¥æ˜¾ç¤ºæ–°çš„å­—æ®µä¿¡æ¯

## ğŸ“ æ›´æ–°æ–‡ä»¶æ¸…å•

- âœ… `backend_service1126.py` - ä¸»è¦åç«¯é€»è¾‘
- âœ… `sql/current_database_schema_sqlserver.sql` - SQL Serverå»ºè¡¨è„šæœ¬
- âœ… `create_database_v2.py` - MySQLå»ºè¡¨è„šæœ¬
- âœ… `migrate_database.py` - æ•°æ®åº“è¿ç§»è„šæœ¬
- âœ… `test_new_api_response.py` - APIæµ‹è¯•è„šæœ¬
- âœ… `APIæ¥å£æ›´æ–°è¯´æ˜.md` - æœ¬è¯´æ˜æ–‡æ¡£

## ğŸ”„ å˜æ›´å½±å“

### å½±å“èŒƒå›´
- âœ… åç«¯æœåŠ¡: æ•°æ®æ¨¡å‹å’ŒAPIå“åº”
- âœ… æ•°æ®åº“: Projectè¡¨ç»“æ„
- âš ï¸ å‰ç«¯é¡µé¢: å¯èƒ½éœ€è¦æ›´æ–°UIæ˜¾ç¤º
- âš ï¸ å¤–éƒ¨é›†æˆ: ä¾èµ–é¡¹ç›®ä¿¡æ¯çš„ç³»ç»Ÿ

### é£é™©è¯„ä¼°
- **ä½é£é™©**: ä½¿ç”¨ `get()` æ–¹æ³•ç¡®ä¿å‘åå…¼å®¹
- **ä½å½±å“**: æ–°å­—æ®µä¸ºå¯é€‰å­—æ®µï¼Œä¸å½±å“ç°æœ‰åŠŸèƒ½
- **æ˜“å›æ»š**: å¯ä»¥é€šè¿‡æ•°æ®åº“å›æ»šå’Œä»£ç ç‰ˆæœ¬æ§åˆ¶å›é€€

---
**æ›´æ–°æ—¶é—´**: 2025-12-17
**ç‰ˆæœ¬**: v1.0
**çŠ¶æ€**: å·²å®Œæˆ