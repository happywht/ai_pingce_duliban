# 统一服务架构 - 快速测试指南

## 🎯 测试目的

验证统一服务架构是否正常工作，确保前端页面和后端API都能正常访问。

---

## 📋 测试前检查

### 1. 确认文件结构

```bash
# 检查backend/static目录是否存在
ls backend/static/

# 应该看到：
# config.js
# config-manager.html
# project/
#   ├── ai_pingce_result.html
#   ├── frontend_improved.html
#   └── project-detail.html
```

### 2. 确认环境配置

```bash
# 检查.env文件是否存在
ls .env

# 如果不存在，创建它
cp .env.sqlserver.example .env
# 然后编辑.env配置数据库连接
```

---

## 🚀 测试步骤

### 步骤1: 启动统一服务

**Windows**:
```cmd
start_backend.bat
```

**Linux/Mac**:
```bash
./start_backend.sh
```

**预期输出**:
```
========================================
🚀 总承包AI智能评测系统 - 统一服务
========================================
📍 项目根目录: /path/to/try3
✅ 配置文件检查通过
========================================
🎯 启动统一服务 (前端 + 后端API)...
========================================
🌐 服务地址: http://localhost:5000
📄 前端页面: http://localhost:5000/project/frontend_improved.html
📊 API接口: http://localhost:5000/api/projects
🔍 配置管理: http://localhost:5000/config-manager.html

按 Ctrl+C 停止服务
========================================
```

### 步骤2: 测试前端页面

打开浏览器，依次访问以下地址：

#### 2.1 测试首页重定向
```
URL: http://localhost:5000/
预期: 自动跳转到项目列表页
状态: ✅ 应该看到项目列表界面
```

#### 2.2 测试项目列表页
```
URL: http://localhost:5000/project/frontend_improved.html
预期: 显示项目列表表格
状态: ✅ 页面正常加载，样式正常
```

#### 2.3 测试配置管理页
```
URL: http://localhost:5000/config-manager.html
预期: 显示配置管理界面
状态: ✅ 页面正常加载，可以输入配置
```

#### 2.4 测试静态文件加载
```
检查: 打开浏览器开发者工具 (F12)
查看: Network标签，确认config.js加载成功
状态: ✅ 无404错误
```

### 步骤3: 测试后端API

使用浏览器或curl测试API接口：

#### 3.1 测试项目列表API
```bash
# 使用curl
curl http://localhost:5000/api/projects

# 或直接在浏览器访问
http://localhost:5000/api/projects
```

**预期结果**:
```json
{
  "projects": [...],
  "total": 0,
  "message": "获取项目列表成功"
}
```

#### 3.2 测试任务统计API
```bash
curl http://localhost:5000/api/task_statistics
```

**预期结果**:
```json
{
  "total_projects": 0,
  "running_tasks": 0,
  "completed_tasks": 0,
  "error_tasks": 0
}
```

### 步骤4: 测试前后端集成

#### 4.1 检查前端是否能调用API

```
1. 打开 http://localhost:5000/project/frontend_improved.html
2. 打开浏览器开发者工具 (F12)
3. 切换到Console标签
4. 查看是否有API调用错误
```

**预期结果**:
- ✅ 无CORS错误（因为是同源）
- ✅ API请求成功返回数据
- ✅ 页面显示项目列表

#### 4.2 检查网络请求

```
1. F12开发者工具
2. Network标签
3. 刷新页面
4. 查看是否有 /api/projects 请求
```

**预期结果**:
- ✅ 状态码 200
- ✅ 返回JSON数据
- ✅ 无跨域错误

---

## ✅ 测试清单

### 基础功能测试

- [ ] **服务启动**: 执行 `./start_backend.sh` 成功启动
- [ ] **首页重定向**: 访问 `/` 自动跳转到项目列表
- [ ] **项目列表页**: `/project/frontend_improved.html` 正常显示
- [ ] **配置管理页**: `/config-manager.html` 正常显示
- [ ] **静态文件**: `config.js` 等静态资源正常加载

### API功能测试

- [ ] **项目列表API**: `/api/projects` 返回JSON数据
- [ ] **任务统计API**: `/api/task_statistics` 返回统计数据
- [ ] **API响应时间**: 响应时间 < 1秒

### 集成测试

- [ ] **无跨域错误**: 前端调用API无CORS错误
- [ ] **数据展示**: 前端正确显示API返回的数据
- [ ] **相对路径**: 前端使用相对路径调用API成功

---

## 🔍 故障排查

### 问题1: 服务启动失败

**症状**: 执行启动脚本后报错

**可能原因**:
1. Python依赖未安装
2. .env配置文件不存在
3. 端口5000被占用

**解决方案**:
```bash
# 1. 安装依赖
pip install -r backend/requirements.txt

# 2. 创建配置文件
cp .env.sqlserver.example .env

# 3. 检查端口占用
# Windows
netstat -ano | findstr :5000

# Linux/Mac
lsof -i :5000
```

### 问题2: 前端页面404

**症状**: 访问 `/project/frontend_improved.html` 返回404

**可能原因**:
1. `backend/static/project/` 目录不存在
2. 文件未正确复制

**解决方案**:
```bash
# 检查文件是否存在
ls backend/static/project/frontend_improved.html

# 如果不存在，重新复制
cp frontend/project/*.html backend/static/project/
```

### 问题3: API返回404

**症状**: 访问 `/api/projects` 返回404

**可能原因**:
1. Flask路由未正确注册
2. 代码语法错误

**解决方案**:
```bash
# 查看Flask日志
tail -f logs/backend_service.log

# 检查路由是否注册
curl http://localhost:5000/api/projects
```

### 问题4: 静态文件加载失败

**症状**: 浏览器控制台显示 `config.js 404`

**可能原因**:
1. 路由优先级问题
2. 静态文件路径错误

**解决方案**:
```bash
# 检查文件是否存在
ls backend/static/config.js

# 检查路由定义顺序
grep -n "@app.route" backend/backend_service1126.py
```

---

## 🎯 性能基准

### 正常性能指标

| 指标 | 预期值 | 说明 |
|------|--------|------|
| **服务启动时间** | < 5秒 | 从执行脚本到服务就绪 |
| **首页加载时间** | < 2秒 | 完整加载HTML+CSS+JS |
| **API响应时间** | < 500ms | 项目列表API响应 |
| **内存占用** | < 200MB | Flask服务内存占用 |

### 性能测试命令

```bash
# 测试服务启动时间
time ./start_backend.sh
# Ctrl+C 停止服务

# 测试API响应时间
time curl http://localhost:5000/api/projects

# 测试并发性能
ab -n 100 -c 10 http://localhost:5000/api/projects
```

---

## 📊 测试报告模板

### 测试环境

```
操作系统: Windows 11 / Linux / macOS
Python版本: 3.x.x
浏览器: Chrome / Firefox / Edge
测试时间: YYYY-MM-DD HH:MM:SS
```

### 测试结果

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 服务启动 | ✅ / ❌ | |
| 首页访问 | ✅ / ❌ | |
| 项目列表页 | ✅ / ❌ | |
| 配置管理页 | ✅ / ❌ | |
| API调用 | ✅ / ❌ | |
| 前后端集成 | ✅ / ❌ | |

### 问题描述

```
记录测试中发现的任何问题
```

### 结论

```
✅ 测试通过 - 可以投入使用
⚠️  部分功能异常 - 需要修复
❌ 测试失败 - 不能投入使用
```

---

## 🎉 测试完成

如果所有测试项都通过，恭喜！统一服务架构已成功部署。

**下一步**:
1. 开始使用新架构进行开发
2. 根据实际需求优化配置
3. 部署到生产环境

**遇到问题？** 查看 `统一服务架构说明.md` 获取详细文档。

---

**测试指南版本**: v1.0
**更新日期**: 2025-12-24
